<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AWS Bedrock WebSocket Test Client</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f8f9fa;
    }
    .container {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      padding: 20px;
    }
    h1 {
      color: #333;
      text-align: center;
    }
    .control-panel {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      padding: 10px;
      background-color: #f1f3f5;
      border-radius: 4px;
    }
    #connectButton, #disconnectButton {
      padding: 8px 16px;
      margin-right: 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
    }
    #connectButton {
      background-color: #28a745;
      color: white;
    }
    #disconnectButton {
      background-color: #dc3545;
      color: white;
    }
    #status {
      margin-left: 10px;
      padding: 5px 10px;
      border-radius: 4px;
      font-weight: bold;
    }
    .disconnected {
      background-color: #f8d7da;
      color: #721c24;
    }
    .connected {
      background-color: #d4edda;
      color: #155724;
    }
    .message-container {
      display: flex;
      margin-bottom: 20px;
    }
    #messageArea {
      flex: 1;
      height: 400px;
      border: 1px solid #ced4da;
      border-radius: 4px;
      overflow-y: auto;
      padding: 10px;
      background-color: white;
    }
    .input-container {
      display: flex;
      margin-top: 20px;
    }
    #messageInput {
      flex: 1;
      padding: 10px;
      border: 1px solid #ced4da;
      border-radius: 4px 0 0 4px;
      font-size: 1rem;
    }
    #sendButton {
      padding: 10px 20px;
      background-color: #007bff;
      color: white;
      border: 1px solid #007bff;
      border-radius: 0 4px 4px 0;
      cursor: pointer;
      font-weight: bold;
    }
    .message {
      margin-bottom: 15px;
      padding: 10px;
      border-radius: 4px;
      max-width: 80%;
      word-break: break-word;
    }
    .user {
      background-color: #e9f5ff;
      color: #0366d6;
      margin-left: auto;
      border-bottom-right-radius: 0;
      text-align: right;
    }
    .server {
      background-color: #f1f3f5;
      color: #495057;
      margin-right: auto;
      border-bottom-left-radius: 0;
    }
    .error {
      background-color: #f8d7da;
      color: #721c24;
      margin-right: auto;
      border-bottom-left-radius: 0;
    }
    .system {
      background-color: #ffeeba;
      color: #856404;
      text-align: center;
      margin: 10px auto;
      font-style: italic;
    }
    .json {
      font-family: monospace;
      white-space: pre-wrap;
    }
    .connection-info {
      margin-bottom: 20px;
      padding: 10px;
      background-color: #f8f9fa;
      border-radius: 4px;
      border-left: 4px solid #007bff;
    }
    .debug-panel {
      margin-top: 20px;
      padding: 10px;
      border: 1px dashed #ced4da;
      border-radius: 4px;
    }
    .debug-panel h3 {
      margin-top: 0;
      color: #6c757d;
    }
    .counter {
      font-size: 0.8rem;
      color: #6c757d;
      margin-left: 5px;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>AWS Bedrock WebSocket Test Client</h1>

  <div class="connection-info">
    <p>Connect to: <code>ws://localhost:8080/ws/bedrock</code></p>
  </div>

  <div class="control-panel">
    <button id="connectButton">Connect</button>
    <button id="disconnectButton" disabled>Disconnect</button>
    <span id="status" class="disconnected">Disconnected</span>
    <span id="messageCounter" class="counter">Messages: 0</span>
  </div>

  <div id="messageArea"></div>

  <div class="input-container">
    <input type="text" id="messageInput" placeholder="Type your message here..." disabled />
    <button id="sendButton" disabled>Send</button>
  </div>

  <div class="debug-panel">
    <h3>Formatting Options</h3>
    <label>
      <input type="checkbox" id="formatJson" checked />
      Format JSON messages
    </label>
    <label style="margin-left: 20px;">
      <input type="checkbox" id="addRequestId" checked />
      Add requestId to messages
    </label>
  </div>
</div>

<script>
  let socket;
  let messageCount = 0;
  const connectButton = document.getElementById('connectButton');
  const disconnectButton = document.getElementById('disconnectButton');
  const sendButton = document.getElementById('sendButton');
  const messageInput = document.getElementById('messageInput');
  const messageArea = document.getElementById('messageArea');
  const statusElement = document.getElementById('status');
  const messageCounter = document.getElementById('messageCounter');
  const formatJsonCheckbox = document.getElementById('formatJson');
  const addRequestIdCheckbox = document.getElementById('addRequestId');

  function addMessage(message, type) {
    messageCount++;
    messageCounter.textContent = `Messages: ${messageCount}`;

    const messageElement = document.createElement('div');
    messageElement.classList.add('message', type);

    // For JSON messages, format them nicely if the option is enabled
    if (type === 'server' || type === 'error' || (type === 'user' && message.startsWith('{'))) {
      try {
        const jsonObj = JSON.parse(message);
        if (formatJsonCheckbox.checked) {
          message = JSON.stringify(jsonObj, null, 2);
        } else {
          message = JSON.stringify(jsonObj);
        }
        messageElement.innerHTML = `<pre class="json">${message}</pre>`;
      } catch (e) {
        messageElement.textContent = message;
      }
    } else {
      messageElement.textContent = message;
    }

    messageArea.appendChild(messageElement);
    messageArea.scrollTop = messageArea.scrollHeight;
  }

  function updateConnectionStatus(connected) {
    connectButton.disabled = connected;
    disconnectButton.disabled = !connected;
    sendButton.disabled = !connected;
    messageInput.disabled = !connected;

    statusElement.textContent = connected ? 'Connected' : 'Disconnected';
    statusElement.classList.toggle('connected', connected);
    statusElement.classList.toggle('disconnected', !connected);

    if (connected) {
      messageInput.focus();
    }
  }

  connectButton.addEventListener('click', function() {
    // Connect to the WebSocket server
    socket = new WebSocket('ws://localhost:8080/ws/bedrock');

    socket.onopen = function(event) {
      updateConnectionStatus(true);
      addMessage('Connection established', 'system');
    };

    socket.onmessage = function(event) {
      addMessage(event.data, 'server');
    };

    socket.onerror = function(error) {
      addMessage('WebSocket Error', 'error');
      console.error('WebSocket Error:', error);
    };

    socket.onclose = function(event) {
      updateConnectionStatus(false);
      addMessage(`Connection closed (Code: ${event.code}${event.reason ? ', Reason: ' + event.reason : ''})`, 'system');
    };
  });

  disconnectButton.addEventListener('click', function() {
    if (socket) {
      socket.close();
    }
  });

  sendButton.addEventListener('click', function() {
    sendMessage();
  });

  messageInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      sendMessage();
    }
  });

  function sendMessage() {
    const message = messageInput.value.trim();
    if (message && socket && socket.readyState === WebSocket.OPEN) {
      // Create a JSON object with the message
      const messageObj = {
        text: message
      };

      // Add requestId if option is checked
      if (addRequestIdCheckbox.checked) {
        messageObj.requestId = generateRequestId();
      }

      const jsonMessage = JSON.stringify(messageObj);
      socket.send(jsonMessage);
      addMessage(jsonMessage, 'user');
      messageInput.value = '';
    }
  }

  function generateRequestId() {
    return 'req_' + Date.now() + '_' + Math.floor(Math.random() * 1000);
  }
</script>
</body>
</html>